# Chat Analysis Message
This is the format of the output messages generated by the Dialog Agent when processing files or Message Bus messages.


## Message Bus Publishing Topic
Analysis of Message Bus messages is published on the Message Bus topic:

```
agent/dialog
```

## Fields
Field Name              | Type   | Description
---                     | ---    | ---
header.timestamp | string | Time of processing by Dialog Agent, in ISO 8601 format: YYYY-MM-DDTHH:MM:SS.SSSZ
header.message_type | string | Message type.  Hardcoded to "**event**"
header.version | string | Dialog Agent software version.  Follows trial.header.version, or "**1.0**" if no trial. 
msg.experiment_id | string | The experiment id this message is associated with
msg.trial_id | string | The trial id this message is associated with
msg.timestamp | string | same as header.timestamp
msg.source | string | The name of this testbed component. Hardcoded to "**uaz_dialog_agent**"
msg.sub_type | string | The subtype of the data.  Hardcoded to "**Event:dialogue_event**"
msg.version | string | Same as header.version
msg.replay_root_id | string | The replay_root_id if being used for the root of a replay.
msg.replay_id | string | The replay_id if being used for a replay.
data.participant_id | string | The participant who generated the message text
data.asr_msg_id | string | A version 4 UUID associated with this message
data.text | string | The text to be processed by the Dialog Agent
data.dialog_act_label | string | Output from the Texas A&M Dialog Act Classifier
data.source.source_type | string | File or Message Bus
data.source.source_name |string | A filename or Message Bus topic
data.extractions | Seq[Extraction] | Analysis of message text

## Extraction Fields
Field Name              | Type   | Description
---                     | ---    | ---
label |string | The type of text in the span
span |string | A substring of the data text to be analyzed.
arguments |map[string, extractions]| Map the Mention label to the taxonomy map
start_offset | int | the starting index of the span in the data text
end_offset | int | The ending index of the span in the data text
taxonomy_matches | Seq[(string, string)] | arguments mapping to the span


## Example
```json
{
  "header": {
    "timestamp": "2021-02-11T19:22:23.494Z",
    "message_type": "event",
    "version": "0.6"
  },
  "msg": {
    "experiment_id":"123e4567-e89b-12d3-a456-426655440000",
    "trial_id": "123e4567-e89b-12d3-a456-426655440000",
    "timestamp": "2019-12-26T14:05:02.1412Z",
    "source": "uaz_dialog_agent",
    "sub_type": "Event:dialogue_event",
    "version": "3.1.5",
    "replay_root_id": "123e4567-e89b-12d3-a456-426655440000",
    "replay_id": "876e4567-ab65-cfe7-b208-426305dc1234"
  },
  "data": {
    "participant_id": "Participant 21",
    "asr_msg_id": "59678a5f-9c5b-451f-8506-04bc020f2cf3",
    "text": "Five because at least I know there was one yellow victim that died so",
    "source": {
      "source_type": "vtt_file",
      "source_name": "AudioTranscript.vtt"
    },
    "extractions": [
      {
        "label": "Sight",
        "span": "was one yellow victim",
        "arguments": "Victim",
        "start_offset": 20,
        "end_offset": 25,
        "taxonomy_matches": [
          {
            "stop-triaging": "11.709686762798679"
          },
          {
            "no-victims-spotted": "10.767969549025242"
          }
        ]
      },
      {
        "label": "Victim",
        "span": "victim",
        "arguments": "",
        "start_offset": 60,
        "end_offset": 75,
        "taxonomy_matches": [
          {
            "stop-triaging-victim": "18.593763750341402"
          },
          {
            "start-triaging-victim": "17.326888048081006"
          }
        ]
      }
    ]
  }
}
```
